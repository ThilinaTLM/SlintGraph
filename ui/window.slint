import { MovableRectangle } from "./movable-rectangle.slint";
import { SingleSideWrapArrowEdge } from "./edge/edge.slint";

struct UiDimention {
    x: length,
    y: length,
    width: length,
    height: length,
}

struct UiNodeData {
    id: string,
    label: string,
    x: length,
    y: length,
    width: length,
    height: length,
    background: color,
}

struct UiEdgeData {
    id: string,
    source: string,
    target: string,
    source-dim: UiDimention,
    target-dim: UiDimention,
}

export global GraphState {
    in-out property <[UiNodeData]> nodes: [];
    in-out property <[UiEdgeData]> edges: [];

    callback update-node(UiNodeData);
    callback update-edge(UiEdgeData);
    callback changed();
}

export component SlintDemoWindow inherits Window {
    width: 800px;
    height: 600px;

    for node in GraphState.nodes: MovableRectangle {
        x: node.x;
        y: node.y;
        width: node.width;
        height: node.height;
        background: node.background;

        Text {
            text: node.label;
            font-size: 20px;
        }

        on-change => {
            GraphState.update-node({
                id: node.id,
                label: node.label,
                x: self.dimentions.x,
                y: self.dimentions.y,
                width: node.width,
                height: node.height,
                background: node.background,
            });
        }
    }

    for edge in GraphState.edges: SingleSideWrapArrowEdge {
        from: {
            x: edge.source-dim.x,
            y: edge.source-dim.y,
            width: edge.source-dim.width,
            height: edge.source-dim.height,
        };
        to: {
            x: edge.target-dim.x,
            y: edge.target-dim.y,
            width: edge.target-dim.width,
            height: edge.target-dim.height,
        };
    }
}
